#=---------------------------------------------------------------------------
# For the most excellent vim: ts=4 noexpandtab syntax=make background=dark
# For braindead emacs: this is a -*-Makefile-*-
#
# Makefile for Envenergy Broadway builds.
# Written by S.T. Mansfield (smansfield@envenergy.com)
#
# @configure_input@
#=---------------------------------------------------------------------------


#=--------------------------------------------------------------------------=#
#=-                DO NOT CHANGE ANYTHING BELOW THIS LINE                  -=#
#=--------------------------------------------------------------------------=#
# NOTE: This section of the makefile is generated by update_makefile.py in   #
#       the root directory of the broadway source tree.  By doing this,      #
#       it is reasonable to keep the almost 200 makefiles in sync with any   #
#       required changes.  To change this section, modify update_makefile.py #
#       and rerun the update_makefiles script.                               #
#=--------------------------------------------------------------------------=#

srcdir = @srcdir@
top_srcdir = @top_srcdir@
include @BUILD_DIR@/Constants.make

#=--------------------------------------------------------------------------=#
#=-                DO NOT CHANGE ANYTHING ABOVE THIS LINE                  -=#
#=--------------------------------------------------------------------------=#


#=---------------------------------------------------------------------------
# Rule: do_makeall
#
#   Required.  Called by the top level makefile via 'Rules.make', or by a
#   call to 'make' in a subdirectory.  Feel free to add other targets here,
#   but you should leave the 'target', 'tools', and 'tests' rules.

do_makeall: target tools tests


#=---------------------------------------------------------------------------
# Define your 'prelease' flist(s)."  See 'config/Rules.make' for a
# discussion of this variable.

PRELEASE:=	broadway

PKG_NAME:=	$(PRELEASE)
PKG_DESC:=	"Broadway: Mediator Framework"
PKG_DEPS:=	broadway.core \
			broadway.nodedefs \
			broadway.ion \
			broadway.sdk.client


#=---------------------------------------------------------------------------
# Include the main 'Rules' file where most of the work is done.  This must
# follow the 'do_makeall' rule and PRELEASE symbols.

include $(RULES_FILE)


#=---------------------------------------------------------------------------
# Use 'TARGETS' to define what you want built.  Anything in the 'TARGETS'
# rule will also be included as part of the 'prelease' build step.
# If you need something built that should not be part of said build step
# create another target list and Makefile rule.  See the HOWTO in the
# dev intranet document for a complete discussion with examples.

TARGETS:=	broadway.install.$(PYEXT)

#=---------------------------------------------------------------------------
# Use 'TOOLS' to define utility programs.  Output from this rule will *not*
# be included in a 'prelease' invocation.

TOOLS:=	mpx_test.$(PYEXT) \
	pextract.$(PYEXT) \
	penvironment.d \
	pextract

pextract:
	cp -fp $(srcdir)/$@ .

penvironment.d:
	@(	mkdir -p ./penvironment.d/var/mpx/config/persistent; \
		mkdir -p ./penvironment.d/var/mpx/log; \
		mkdir -p ./penvironment.d/var/run; \
		mkdir -p ./penvironment.d/etc; \
		mkdir -p ./penvironment.d/tmp; \
	)

target: $(TARGETS)

#=---------------------------------------------------------------------------
# Use 'TOOLS' to define utility programs.  Output from this rule will *not*
# be included in a 'prelease' invocation.

tools: $(TOOLS)


#=---------------------------------------------------------------------------
# Use 'TESTS' to define test programs.  Any programs here will also be
# invoked when 'make unittest' is run.  Output from this rule will *not*
# be included in a 'prelease' invocation.

_test_DefaultTestFixture.py: $(srcdir)/$@
	cp -fp $(srcdir)/$@ .

TESTS:=	_test_DefaultTestFixture.py \
	_test_case_mpx_test.$(PYEXT)

tests: $(TESTS)


#=- EOF --------------------------------------------------------------------=#
